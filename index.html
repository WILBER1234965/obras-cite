<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Generación de CITES</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="icon" type="image/png" href="logo.png">

    <!-- tus estilos locales -->
    <link rel="stylesheet" href="styles.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        }
                    }
                }
            }
        }
    </script>

</head>
<body class="text-gray-800">
    <div id="login-container" class="flex items-center justify-center min-h-screen p-4">
        <div class="glass w-full max-w-md p-8 rounded-xl shadow-2xl">
            <div class="text-center mb-8">
                <img src="logo.png" alt="Logo" class="mx-auto h-20 w-20 rounded-full border-4 border-white shadow-lg">
                <h1 class="text-3xl font-bold text-white mt-4">Sistema de CITES</h1>
                <p class="text-white/70 mt-2">Ingrese sus credenciales para acceder</p>
            </div>
            <form id="login-form" class="space-y-6">
                <div>
                    <label for="username" class="block text-sm font-medium text-white">Usuario</label>
                    <div class="mt-1">
                        <input type="text" id="username" name="username" required class="w-full px-4 py-3 rounded-lg bg-white/90 focus:ring-2 focus:ring-blue-500 focus:outline-none transition duration-200">
                    </div>
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium text-white">Contraseña</label>
                    <div class="mt-1">
                        <input type="password" id="password" name="password" required class="w-full px-4 py-3 rounded-lg bg-white/90 focus:ring-2 focus:ring-blue-500 focus:outline-none transition duration-200">
                    </div>
                </div>
                <div>
                    <button type="submit" class="w-full bg-primary-600 hover:bg-primary-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200 flex items-center justify-center">
                        <i class="fas fa-sign-in-alt mr-2"></i> Iniciar Sesión
                    </button>
                </div>
            </form>
            <p id="login-error" class="mt-4 text-red-300 text-center hidden"></p>
        </div>
    </div>

    <div id="app-container" class="hidden min-h-screen">
        <!-- Sidebar -->
        <div class="sidebar fixed inset-y-0 left-0 w-64 bg-white/10 glass z-50 transform -translate-x-full md:translate-x-0 transition duration-300" id="sidebar">
            <div class="flex items-center justify-between p-4 border-b border-white/10">
                <div class="flex items-center space-x-3">
                    <img src="logo.png" alt="User" class="h-9 w-9 rounded-full border-2 border-white">
                    <span class="text-lg font-semibold text-white" id="profile-name">Usuario</span>
                </div>
                <button id="close-sidebar" class="md:hidden text-white focus:outline-none">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <ul class="space-y-2">
                    <li>
                        <a href="#" class="flex items-center p-3 text-white hover:bg-white/10 rounded-lg transition duration-200" id="nav-dashboard">
                            <i class="fas fa-home mr-3"></i> Inicio
                        </a>
                    </li>
                    <li id="nav-generate-container">
                        <a href="#" class="flex items-center p-3 text-white hover:bg-white/10 rounded-lg transition duration-200" id="nav-generate">
                            <i class="fas fa-plus-circle mr-3"></i> Generar CITE
                        </a>
                    </li>
                    <li id="nav-my-cites-container">
                        <a href="#" class="flex items-center p-3 text-white hover:bg-white/10 rounded-lg transition duration-200" id="nav-my-cites">
                            <i class="fas fa-list mr-3"></i> Mis CITES
                        </a>
                    </li>
                    <li id="nav-all-cites-container" class="hidden">
                        <a href="#" class="flex items-center p-3 text-white hover:bg-white/10 rounded-lg transition duration-200" id="nav-all-cites">
                            <i class="fas fa-list-alt mr-3"></i> Todos los CITES
                        </a>
                    </li>
                    <li id="nav-users-container" class="hidden">
                        <a href="#" class="flex items-center p-3 text-white hover:bg-white/10 rounded-lg transition duration-200" id="nav-users">
                            <i class="fas fa-users mr-3"></i> Usuarios
                        </a>
                    </li>
                </ul>
                <div class="mt-8 pt-4 border-t border-white/10">
                    <button id="logout-btn" class="flex items-center w-full p-3 text-white hover:bg-white/10 rounded-lg transition duration-200">
                        <i class="fas fa-sign-out-alt mr-3"></i> Cerrar Sesión
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="md:ml-64 transition-all duration-300">
            <!-- Top Navigation -->
            <nav class="glass py-4 px-6 flex items-center justify-between">
                <div class="flex items-center">
                    <button id="menu-toggle" class="md:hidden text-white focus:outline-none mr-4">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h2 class="text-xl font-semibold text-white" id="page-title">Inicio</h2>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="relative" id="notification-icon">
                        <button class="text-white focus:outline-none">
                            <i class="fas fa-bell"></i>
                        </button>
                        <span class="absolute top-0 right-0 h-2 w-2 rounded-full bg-red-500 animate-pulse"></span>
                    </div>
                    <button id="profile-btn" class="flex items-center focus:outline-none">
                        <img src="https://via.placeholder.com/40" alt="User" class="h-8 w-8 rounded-full border-2 border-white">
                        <span class="ml-2 text-white hidden md:inline" id="username-display">Usuario</span>
                    </button>
                </div>
            </nav>

            <!-- Pages -->
            <div class="p-6">
                <!-- Dashboard Page -->
                <div id="dashboard-page">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="glass p-6 rounded-xl text-white">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm opacity-80">Total CITES</p>
                                    <h3 class="text-2xl font-bold mt-1" id="total-cites">0</h3>
                                </div>
                                <div class="p-3 bg-white/20 rounded-lg">
                                    <i class="fas fa-file-alt text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="glass p-6 rounded-xl text-white">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm opacity-80">Mis CITES</p>
                                    <h3 class="text-2xl font-bold mt-1" id="user-cites">0</h3>
                                </div>
                                <div class="p-3 bg-white/20 rounded-lg">
                                    <i class="fas fa-user-check text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="glass p-6 rounded-xl text-white">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm opacity-80">Sistema</p>
                                    <h3 class="text-2xl font-bold mt-1" id="last-date">CARGANDO...</h3>
                                </div>
                                <div class="p-3 bg-white/20 rounded-lg">
                                    <i class="fas fa-calendar-alt text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="glass p-6 rounded-xl mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-white">Últimos CITES</h3>
                            <button id="view-all-cites" class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg text-sm transition duration-200">
                                Ver todos
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-white">
                                <thead>
                                    <tr class="border-b border-white/20">
                                        <th class="pb-3 text-left">N° CITE</th>
                                        <th class="pb-3 text-left">Documento</th>
                                        <th class="pb-3 text-left">Usuario</th>
                                        <th class="pb-3 text-left">Fecha</th>
                                        <th class="pb-3 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="recent-cites">
                                    <!-- Filled by JS -->
                                </tbody>
                            </table>
                        </div>
                        <div id="no-recent-cites" class="py-10 text-center text-white/70 hidden">
                            <i class="fas fa-info-circle text-3xl mb-3"></i>
                            <p>No hay CITES recientes</p>
                        </div>
                    </div>

                    <div class="glass p-6 rounded-xl">
                        <h3 class="text-lg font-semibold text-white mb-4">Generar nuevo CITE</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <p class="text-sm text-white/80 mb-4">Complete los datos para generar un nuevo CITE para su documento</p>
                                <form id="cite-form" class="space-y-4">
                                    <div>
                                        <label for="document-name" class="block text-sm font-medium text-white mb-1">Nombre del Documento</label>
                                        <input type="text" id="document-name" class="w-full px-4 py-2 rounded-lg bg-white/20 text-white placeholder-white/50 focus:ring-2 focus:ring-primary-500 focus:outline-none transition duration-200" placeholder="Ingrese el nombre del documento" required>
                                    </div>
                                    <button type="submit" class="bg-primary-600 hover:bg-primary-700 text-white px-6 py-2 rounded-lg transition duration-200">
                                        <i class="fas fa-plus mr-2"></i> Generar CITE
                                    </button>
                                </form>
                            </div>
                            <div class="flex items-center justify-center">
                                <div class="glass-dark p-8 rounded-lg text-center max-w-xs">
                                    <i class="fas fa-file-alt text-5xl text-primary-300 mb-4"></i>
                                    <h4 class="text-xl font-semibold text-white mb-2">CITE Generado</h4>
                                    <p id="generated-cite" class="text-primary-200 font-mono">GAMT/D.OO.PP. Nº ---/----</p>
                                    <div id="cite-info" class="text-sm text-white/70 mt-4 hidden">
                                        <p>Usuario: <span id="cite-user">-</span></p>
                                        <p>Fecha: <span id="cite-date">-</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- My CITES Page -->
                <div id="my-cites-page" class="hidden">
                    <div class="glass p-6 rounded-xl mb-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-semibold text-white">Mis CITES</h2>
                            <div class="flex space-x-3">
                                <button id="refresh-my-cites" class="bg-white/10 hover:bg-white/20 text-white p-2 rounded-lg transition duration-200">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full text-white">
                                <thead>
                                    <tr class="border-b border-white/20">
                                        <th class="pb-3 text-left">N° CITE</th>
                                        <th class="pb-3 text-left">Documento</th>
                                        <th class="pb-3 text-left">Fecha</th>
                                        <th class="pb-3 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="my-cites-list">
                                    <!-- Filled by JS -->
                                </tbody>
                            </table>
                        </div>
                        <div id="no-my-cites" class="py-10 text-center text-white/70 hidden">
                            <i class="fas fa-info-circle text-3xl mb-3"></i>
                            <p>No has generado ningún CITE todavía</p>
                            <button class="mt-4 bg-primary-600 hover:bg-primary-700 text-white px-6 py-2 rounded-lg transition duration-200" id="generate-from-my-cites">
                                <i class="fas fa-plus mr-2"></i> Generar CITE
                            </button>
                        </div>
                    </div>
                </div>

                <!-- All CITES Page (Superadmin) -->
                <div id="all-cites-page" class="hidden">
                    <div class="glass p-6 rounded-xl mb-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-semibold text-white">Todos los CITES</h2>
                            <div class="flex space-x-3">
                                <button id="export-cites" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm transition duration-200">
                                    <i class="fas fa-file-excel mr-2"></i> Exportar
                                </button>
                                <button id="refresh-all-cites" class="bg-white/10 hover:bg-white/20 text-white p-2 rounded-lg transition duration-200">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full text-white">
                                <thead>
                                    <tr class="border-b border-white/20">
                                        <th class="pb-3 text-left">N° CITE</th>
                                        <th class="pb-3 text-left">Documento</th>
                                        <th class="pb-3 text-left">Usuario</th>
                                        <th class="pb-3 text-left">Fecha</th>
                                        <th class="pb-3 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="all-cites-list">
                                    <!-- Filled by JS -->
                                </tbody>
                            </table>
                        </div>
                        <div id="no-cites" class="py-10 text-center text-white/70 hidden">
                            <i class="fas fa-info-circle text-3xl mb-3"></i>
                            <p>No hay CITES en el sistema</p>
                        </div>
                    </div>
                </div>

                <!-- Users Page (Superadmin) -->
                <div id="users-page" class="hidden">
                    <div class="glass p-6 rounded-xl mb-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-semibold text-white">Usuarios</h2>
                            <button id="add-user-btn" class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg text-sm transition duration-200">
                                <i class="fas fa-plus mr-2"></i> Nuevo Usuario
                            </button>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full text-white">
                                <thead>
                                    <tr class="border-b border-white/20">
                                        <th class="pb-3 text-left">Usuario</th>
                                        <th class="pb-3 text-left">Nombre</th>
                                        <th class="pb-3 text-left">CITES Generados</th>
                                        <th class="pb-3 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="users-list">
                                    <!-- Filled by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="add-user-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 hidden">
        <div class="glass w-full max-w-md p-6 rounded-lg">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-white">Agregar Usuario</h3>
                <button id="close-add-user-modal" class="text-white/70 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="add-user-form" class="space-y-4">
                <div>
                    <label for="new-username" class="block text-sm font-medium text-white mb-1">Usuario</label>
                    <input type="text" id="new-username" class="w-full px-4 py-2 rounded-lg bg-white/20 text-white placeholder-white/50 focus:ring-2 focus:ring-primary-500 focus:outline-none transition duration-200" placeholder="Ingrese el nombre de usuario" required>
                </div>
                <div>
                    <label for="new-name" class="block text-sm font-medium text-white mb-1">Nombre Completo</label>
                    <input type="text" id="new-name" class="w-full px-4 py-2 rounded-lg bg-white/20 text-white placeholder-white/50 focus:ring-2 focus:ring-primary-500 focus:outline-none transition duration-200" placeholder="Ingrese el nombre completo" required>
                </div>
                <div>
                    <label for="new-password" class="block text-sm font-medium text-white mb-1">Contraseña</label>
                    <input type="password" id="new-password" class="w-full px-4 py-2 rounded-lg bg-white/20 text-white placeholder-white/50 focus:ring-2 focus:ring-primary-500 focus:outline-none transition duration-200" placeholder="Ingrese la contraseña" required>
                </div>
                <div>
                    <label for="new-password-confirm" class="block text-sm font-medium text-white mb-1">Confirmar Contraseña</label>
                    <input type="password" id="new-password-confirm" class="w-full px-4 py-2 rounded-lg bg-white/20 text-white placeholder-white/50 focus:ring-2 focus:ring-primary-500 focus:outline-none transition duration-200" placeholder="Confirme la contraseña" required>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" id="cancel-add-user" class="px-4 py-2 rounded-lg text-white hover:bg-white/10 transition duration-200">
                        Cancelar
                    </button>
                    <button type="submit" class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg transition duration-200">
                        Guardar
                    </button>
                </div>
                <div id="add-user-error" class="text-red-300 text-sm mt-2 hidden"></div>
            </form>
        </div>
    </div>

    <!-- Edit Cite Modal -->
    <div id="edit-cite-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 hidden">
        <div class="glass w-full max-w-md p-6 rounded-lg">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-white">Editar CITE</h3>
                <button id="close-edit-cite-modal" class="text-white/70 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="edit-cite-form" class="space-y-4">
                <input type="hidden" id="edit-cite-id">
                <input type="hidden" id="edit-cite-number">
                <div>
                    <label for="edit-document-name" class="block text-sm font-medium text-white mb-1">Nombre del Documento</label>
                    <input type="text" id="edit-document-name" class="w-full px-4 py-2 rounded-lg bg-white/20 text-white placeholder-white/50 focus:ring-2 focus:ring-primary-500 focus:outline-none transition duration-200" required>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" id="cancel-edit-cite" class="px-4 py-2 rounded-lg text-white hover:bg-white/10 transition duration-200">
                        Cancelar
                    </button>
                    <button type="submit" class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg transition duration-200">
                        Guardar
                    </button>
                </div>
                <div id="edit-cite-error" class="text-red-300 text-sm mt-2 hidden"></div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-confirm-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 hidden">
        <div class="glass w-full max-w-md p-6 rounded-lg">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-white" id="delete-modal-title">Confirmar Eliminación</h3>
                <button id="close-delete-modal" class="text-white/70 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mb-6 text-white/80">
                <p id="delete-modal-message">¿Estás seguro que deseas eliminar este elemento?</p>
            </div>
            <div class="flex justify-end space-x-3">
                <button type="button" id="cancel-delete" class="px-4 py-2 rounded-lg text-white hover:bg-white/10 transition duration-200">
                    Cancelar
                </button>
                <button type="button" id="confirm-delete" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition duration-200">
                    Eliminar
                </button>
            </div>
        </div>
    </div>
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyCYIzgm_E5lP-lEzuZZYXL9lUJTJD2GIww",
    authDomain: "cites-9181d.firebaseapp.com",
    projectId: "cites-9181d",
    storageBucket: "cites-9181d.firebasestorage.app",
    messagingSenderId: "558790968993",
    appId: "1:558790968993:web:9cc851d7c15f0e155392e0",
    measurementId: "G-68WG92LTGY"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
</script>
  <script src="script.js"></script>
</body>
</html>